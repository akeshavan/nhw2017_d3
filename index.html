<!DOCTYPE html>
<html lang="en">

  <head>
    <title> Neurohackweek 2017 D3 Tutorial </title>
    <!-- Style definitions will go in the <style> tags -->
    <style>

    .bar {
      background: steelblue;
      height: 30px;
      margin: 5px;
      color: white;
      text-align: right;
      padding-right: 5px;
      padding-top: 5px;
    }

    </style>

  </head>

  <!-- Content goes in the body -->
  <body>

    <h1> Hello World </h1>
    <p> This is a paragraph </p>
    <a href="http://www.google.com"> here is a link </a>
    <h3> My first bar graph with div elements</h3>
    <button onclick="addData()"> Add data </button>
    <button onclick="randomData()"> Randomize data </button>
    <button onclick="removeData()"> Remove data </button>
    <div id="plotArea"></div>
    <h3> Below is a scatter plot: </h3>
    <svg id="scatterArea"></svg>

  </body>

  <!-- Import Javascript files here-->
  <script src="js/d3.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script>

  var data = [100, 150, 60, 80, 140]

  function render(data){
    // add data
    d3.select("#plotArea").selectAll(".bar")
      .data(data).enter().append("div")
      .attr("class", "bar")
      .style("width", 0)

    // update data
    d3.select("#plotArea").selectAll(".bar")
      .transition()
      .duration(1000)
      .style("width", function(d){return d+"px"})
      .text(function(d){return d})

    // remove data
    d3.select("#plotArea").selectAll(".bar").data(data)
      .exit()
      .transition()
      .duration(1000)
      .style('opacity', 0)
      .remove()

    d3.select("#plotArea").selectAll(".bar")
    .on("mouseover",  function(d){
      d3.select(this).style("background", "black")
    })
    .on("mouseout",  function(d){
      d3.select(this).style("background", "steelblue")
    })
    .on("click", function(d, i){
      d3.select(this)
        .transition()
        .ease(d3.easeBounce)
        .duration(1000)
        .style("width", function(d){return d*1.5+"px"})
        .text(function(d){return d*1.5})

      //re-bind the data
      data[i] = data[i] * 1.5
      d3.select("#plotArea").selectAll(".bar")
        .data(data)
    })
  }

  render(data)

  function randomInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function addData(){
    data.push(randomInt(30,200)) //append a random number to data
    render(data)
  }

  function randomData(){
    for (i=0; i<data.length; i++){
      data[i] = randomInt(30,200)
    }
    render(data)
  }

  function removeData(){
    data.pop() //remove last element
    render(data)
  }



  function renderAxes(data){
      //define margins on the plot -- this will give room for axes labels, titles
      var margin = {top: 20, right: 20, bottom: 30, left: 60}

      // total dimensions are 500x300
      var width = 500 - margin.left - margin.right
      var height = 300 - margin.top - margin.bottom

      // data struct -> x value
    var xValue = function(d) { return d.x;}
    var yValue = function(d) { return d.y;}

    // value -> display
    xScale = d3.scaleLinear().range([0, width])
    yScale = d3.scaleLinear().range([height, 0]),
    // in SVG, y=0 is at the top, so we switch the order

    // now the range [0, width] maps to [0, max(data)]
    xScale.domain([d3.min(data, xValue), d3.max(data, xValue)])
    yScale.domain([d3.min(data, xValue), d3.max(data, yValue)])

    var svg = d3.select("#scatterArea")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    xAxis = d3.axisBottom(xScale) //axis object
    yAxis = d3.axisLeft(yScale)

    // x-axis
    svg.append("g")
     .attr("class", "x axis")
     //take X to bottom of SVG
     .attr("transform", "translate(0," + height + ")")
     .call(xAxis)

    // y-axis
    svg.append("g")
     .attr("class", "y axis")
     .call(yAxis)

  }

  var scatterData = [
    {x: 0.5, y: 20},
    {x: 2.1, y: 12},
    {x: 1.4, y: 5.2},
    {x: 2.9, y: 9.6}
]

renderAxes(scatterData)


  </script>

</html>
